# API для управления кофемашиной


# Функционал программы:

## Клиентский АПИ
- Готовка кофе
- Получение рейтинга напитков
- Получение меню напитков c описанием их ингредиентов:

  <img>![Тело ответа на получение меню](src/main/resources/scrinshots/menu_response.png)

## Админский АПИ
- Занесение новых ингредиентов
- Занесение новых напитков и их рецептуры:

  <img>![Тело запроса на создание напитка](src/main/resources/scrinshots/recipt.png)

- Удаление напитков по идентификаторам
- Удаление ингредиентов по идентификаторам
- Пополнение емкостей с ингридиентами

_________


# Основная схема АПИ в Swagger:
<img>![Общий список конечных точек АПИ](src/main/resources/scrinshots/api.png)


_________


# Особенности программы:

### 1. АПИ системы вынесено в Swagger.
Каждая конечная точка в Swagger UI содержит описание функционала, а также примеры принимаемых и возвращаемых значений:

<img>![Пример оформления тела запроса в Swagger](src/main/resources/scrinshots/response.png)

### 2. Гибкая логика.
Написанное АПИ универсально. В него можно добавлять по отдельности ингредиенты и связанные с ними напитки с рецептами.
Также у каждого ингредиента имеется емкость бака, которая уменьшается в зависимости от выбранного объема напитка.

<img>![](src/main/resources/scrinshots/tank.png)

### 3. Наличие системы логирования и миграций базы данных.
- В программу была включена система логирования на основе Logback. В ходе работы программы данные автоматически пишутся
  в файлы:

<img>![Логи и скрипты для миграций в дереве проекта](src/main/resources/scrinshots/logs.png)

- Для миграций базы данных использовался FlyWay. Написанный скрипт хранит базовую версию таблиц приложения.

### 5. Наличие системы очистки статистики.
Программа может сохранять данные о ретинге имеющихся напитков:

<img>![Запись рейтинга](src/main/resources/scrinshots/rating.png)

Сохраненные значения должны очищаться каждые 5 лет. Для решения данной задачи используется планировщик Spring - @Scheduler:

<img>![Код планировщика](src/main/resources/scrinshots/scheduler.png)

### 5. Наличие ограничений доступа к АПИ.
Кофемашина может готовить только 30 чашек кофе в час :( Для создания данного ограничения использовался Bucket4j:

<img>![](src/main/resources/scrinshots/bucket4j.png)

Результат превышения нормы:

<img>![](src/main/resources/scrinshots/429.png)
